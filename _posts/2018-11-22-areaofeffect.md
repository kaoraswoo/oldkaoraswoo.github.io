---
layout: post
title: 장판 고려
categories:
- 게임
---

# 서버에서 고려한사항

## 장판
### 특정위치에 생성되는 독립적인 효과Entity
	* 지속적으로 효과(데미지,힐)를 해당위치에서 interval마다 주거나, Buff/Debuff를 넣어준다
	* 장판Entity의 생성된 위치를 기준으로 LifeTime동안 효과의 패턴이 있을수 있다(ex: 데미지를 주는 불막대기가 시계방향으로 일정하게 돈다, 회오리객체가 특정 2위치를 patrol한다거나)
	* 기존의 서펜투스의 하늘에서 랜덤으로 떨어지는 스킬은 순간 데미지이기에 장판이 아닌 다른 것으로 처리하자( 랜덤 Instant범위공격 )

## 장판은 기본적으로 몬스터스킬, 혹은 기믹으로만 생성한다.(즉, 장판에 영향받는 타겟은 PC가 되어야한다)
    * 만약 PC가 몬스터에게 영향을 주는 장판을 꼭 생성해야 한다면, 제약을 두어서 Interval 간격을 길게 1초이상)

## (클라이언트) 그러므로 장판의 충돌한 PC를 찾는 것은 클라이언트의 도움을 받는다 
    * (장판안 진입시점마다 패킷을 받고,  장판자체Entity List로 데미지받을 후보들 관리함- 장판에서 빠져나가는것은 서버가 판단한다)
	*  장판내에 있을때 계속 효과 줘야하는것들은,
        ** 진입시점에 클라에서 타겟을 받아서(후보리스트 구성)
        ** 그 후보리스트내에서 위치검증을 하고,
        ** 조건들(Interval, 이미 해당효과있는지여부)만 체크해서, 데미지/버프/디버프를 넣어주고
        ** 후보리스트에서 빼는것은 서버(Update)에서 처리.

## 장판 Table
    * 장판의 모양,형태, Interval, 지속시간, 관련된 테이블 혹은 컬럼들 필요
    * SkillCoverage_Table이 상당히 비슷하긴함 - Interval, LifeTime이 없긴하지만, AbilityLauncher에서 생성시 보완가능

## 장판의 생성위치어떤 Map의 특정위치를 기준으로 발동하거나(DamagePoint필요),  시전자(Self), 타겟의 위치 기준으로 생성

## (클라이언트)장판의 Move
### 기본적으로 장판객체는 생성위치(시전자주변위치이거나, DamagePoint)에서 움직이지 않는다(즉 움직이는 부분은 Sub장판효과)
  * 1 Sub장판은 시전위치 주위를 특정 속도로 뱅뱅 돌거나, 순찰하듯이 움직한다
  * 2 Sub장판은 맵의 막힌거나 장애물 상관없이 돌거나 이동되어야한다.(Vector포지션 혹은 각도 기반)
  * 3 생성시간과 속도를 기반으로, 클라이언트와 서버 양쪽에서 시뮬레이션을 한다

## 장판생성규칙
    * 시전자의 Stat에서 -> 장판의 Stat에  어떤 항목들을 어떤 비율의 수치로 복사해 넣을것인가에 대한 규칙이 필요 
        ** (ex: 장판이 물리타입일경우, 시전자의 MeleeDamagePoint의 70% 수치만 장판의 MeleeDamagePoint에 반영한다)
        ** Stat 시스템을 쓴다면, 기존 Stat시스템과 공식을 그대로 사용도 가능.-> 혹은 간략화된 다른 Stat과 공식을 만들수도 있음(최적화를 위해서)

## 시전자와 독립적인 장판
    * 장판 생성후 시전자와 관계없이 독립적인 개체 가자 (기본적으로 무조건 Lifetime(수명)을 두어서, 최대한 시전자와 독립적으로 작동하게 한다.)  - 시전자의 수명/디스펠에 영향을 받는 장판은 없게하자( 구현의 간결성 )

## 최대장판갯수 제한
    * 해당시전자가 맵에 깔 수 있는 최대장판갯수 정의 필요(ex: 해당시전자의 장판 4개가 이미 맵에 발동중이면, 더이상 장판소환이 안된다 등 )  - 이렇게 제한을 하려면 어느정도 시전자가 장판에 대해서 관리가 필요(entityID정도)
